{% extends "main.html" %}

{% block "main-content" %}

<link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/github.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>

{% block "navigation" %}
	<a class="link-dark ps-2" style="text-decoration: none;" href="{% url "jobs:index" %}">
	Home 
	</a> 
		<svg class="m-1" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 19">
		<path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
		</svg> 
	<a class="link-dark" style="text-decoration: none;" href="{% url "jobs:index" %}">
	Jobs
	</a> 
	<svg class="m-1" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 19">
	<path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
	</svg> 
	<a class="link-dark" href="{% url "jobs:results:index" job.job_id%}" style="text-decoration: none;">
	Matches
	</a>
    <svg class="m-1" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 19">
    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
    </svg> 
    <a href="#" style="text-decoration: none;">
    Match
    </a>
{% endblock %}

{% comment %} <div class="mb-3"> <h2>Matches</h2> </div> {% endcomment %}

{{submissions}}
{{match_info}}
<style>

pre {
    float: left;
    min-width: 100%;
    margin:0;
}


.match {
    transition: all ease-out 0.1s;
}

.code-window{
    position:relative;
}

</style>

<body>
<div class="container d-flex shadow" style="background-color:white;padding:0; max-height: calc(100vh - 350px)">
    
    {% for key, values in blocks.items %}
    <div class="code-window w-50" style="overflow-x:auto; border: solid 1px">
        
        {% for x in values %}
            <pre {% if x.id %} match="{{x.id}}" class="language-{{language}} match" {% else %} class="language-{{language}}" {% endif %}>{{x.text}}</pre>
        {% endfor %}

    </div>
    {% endfor %}
    
</div>
</body>


<script>
hljs.configure({
    cssSelector: 'pre'
})
hljs.highlightAll();

let colours = {{ colours | js }};

let hoverOpacity = 0.5;
let defaultOpacity = 0.2;
function setMatches(matchID, opacity){
    document.querySelectorAll(`.match[match="${matchID}"]`).forEach(x=>{
        x.style.backgroundColor = `rgba(${colours[matchID % colours.length]}, ${opacity})`;
    })
}
document.querySelectorAll(".match").forEach(m => {
    let matchID = m.getAttribute('match');
    console.log(matchID);

    m.addEventListener("mouseover", e => {
        setMatches(matchID, hoverOpacity);
    });
    
    m.addEventListener("mouseout", e => {
        setMatches(matchID, defaultOpacity);
    });
    m.addEventListener("click", e => {
        console.log(matchID);
        document.querySelectorAll(`.match[match="${matchID}"]`).forEach(x=>{
            let parent = x.closest('.code-window');

            let toScrollTo = 0;
            if(x.offsetHeight > parent.offsetHeight){
                toScrollTo = x.offsetTop; // - 10;
            }else{
                toScrollTo = x.offsetTop - (parent.offsetHeight - x.offsetHeight)/2;
            }
            parent.scrollTo({top: toScrollTo, left: 0, behavior: 'smooth'});

        })

    }); 

    setMatches(matchID, defaultOpacity)
});

</script> 

{% endblock %}
