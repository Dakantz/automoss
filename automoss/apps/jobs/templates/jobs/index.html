{% extends "main.html" %}
{% load static %}

{% block "links" %}
<link href="{% static "css/dropZoneFile.css" %}" rel="stylesheet">
<link href="{% static "css/dropZone.css" %}" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/animatecss/3.5.2/animate.min.css" rel="stylesheet" crossorigin="anonymous">
{% endblock %}

{% block "scripts" %}
<script src="{% static "js/dropZoneFile.js" %}" defer></script>
<script src="{% static "js/dropZone.js" %}" defer></script>
<script src="{% static "lib/uncompress/bz2.js" %}" defer></script>
<script src="{% static "lib/uncompress/pako.min.js" %}" defer></script>
<script src="{% static "lib/uncompress/uncompress.js" %}" defer></script>
<script src="{% static "lib/uncompress/archive.lib.min.js" %}" defer></script>
<script src="{% static "lib/uncompress/xz.js" %}" defer></script>
<script src="{% static "js/job.js" %}" defer></script>
<script src="{% static "js/jobSubmission.js" %}" defer></script>
<script src="{% static "js/jobTable.js" %}" defer></script>
{% endblock %}

{% block "main-content" %}

{% block "navigation" %}
<!-- Navigation -->
	<a class="link-dark ps-2" style="text-decoration: none;" href="#">
	Home 
	</a> 
		<svg class="m-1" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-chevron-right" viewBox="0 0 16 19">
		<path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
		</svg> 
	<a class="" style="text-decoration: none;" href="#">
	Jobs
	</a> 
{% endblock %}

<!-- Page Title -->
<h2 class="py-2 px-1 fw-bold">
	Submitted Jobs
</h2>

<!-- Content -->
<div class="container-fluid shadow-sm bg-white py-3 px-4 rounded-3">

<!-- Search/Create -->
<div class="row mb-3">
	<div class="col-lg-12">
		<div class="input-group px-1 pt-2 justify-content-between">
			<input class="form-control me-2 rounded" id="job-search" type="search" placeholder="Search..." aria-label="Search">
			<span class="input-group-btn">
				<button type="button" class="btn btn-primary text-light rounded-pill" data-bs-toggle="modal" data-bs-target="#create-job-modal">
					<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-plus" viewBox="4 2.5 13 13">
						<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
					  </svg>
					Create Job</button>
			</span>
		</div>
	</div>
</div>

<!-- Table -->
<table id="job-table" class="table table-hover table-striped border rounded-3" style="background-color: white">

	<!-- Headings -->
	<thead class="table-dark">
		<tr>
			<th scope="col" style="width: 30%">Name</th>
			<th scope="col" style="width: 30%">Language</th>
			<th scope="col" style="width: 30%">Date Created</th>
			<th scope="col" style="width: 10%">Status</th>
		</tr>
	</thead>
	
	<!-- Jobs -->
	<tbody></tbody>

</table>
<div id="no-jobs-message" class="container text-center" style="display: none">No jobs have been created yet!</div>

	<!-- Modal -->
	<div class="modal fade" id="create-job-modal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<form id="create-job-form">

					{% csrf_token %}

					<!-- Header -->
					<div class="modal-header bg-dark text-light">
						<h5 class="modal-title"><b>Create Job</b></h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>

					<!-- Body -->
					<div class="modal-body">

						<!-- Drop Zone -->
						<div class="mb-3">
							<drop-zone id="job-drop-zone" filetypes="rar,tar,tar.bz2,tar.gz,tar.xz,zip" text="Drag and drop <b>student</b> files here!"></drop-zone>
						</div>

						<!-- Name -->
						<div class="mb-3">
							<label for="job-name">Name:</label>
							<input class="form-control" id="job-name" type="text" name="job-name" autocomplete="off" data-lpignore="true" data-form-type="text">
						</div>

						<!-- Language -->
						<div class="mb-3">
							<label for="job-language">Language:</label>
							<select class="form-select" id="job-language" name="job-language" data-form-type="other">
								{% for language, info in SUPPORTED_LANGUAGES.items %}
									<option language-id={{language}}>{{info.0}} </option>
								{% endfor %}
							</select>
						</div>

						<!-- Max Matches Until Ignored -->
						<div class="mb-3">
							<label for="job-max-until-ignored" class="form-label">Max matches until ignored:</label>
							<div class="d-flex">
								<input type="range" class="form-range" min="0" step="1" max="1000" id="job-max-until-ignored" name="job-max-until-ignored" value="{{DEFAULT_MOSS_SETTINGS.max_until_ignored}}" oninput="this.nextElementSibling.value = this.value">
								<output style="width: 50px; text-align: right;">{{DEFAULT_MOSS_SETTINGS.max_until_ignored}}</output>
							</div>
						</div>

						<!-- Max Matches Displayed -->
						<div class="mb-3">
							<label for="job-max-displayed-matches" class="form-label">Max matches displayed:</label>
							<div class="d-flex">
								<input type="range" class="form-range" min="0" step="1" max="1000" id="job-max-displayed-matches" name="job-max-displayed-matches" value="{{DEFAULT_MOSS_SETTINGS.max_displayed_matches}}" oninput="this.nextElementSibling.value = this.value">
								<output style="width: 50px; text-align: right;">{{DEFAULT_MOSS_SETTINGS.max_displayed_matches}}</output>
							</div>
						</div>

						<!-- Base Files -->
						<div class="mb-3">
							<label for="job-attach-base-files">Attach base files?</label>
							<input class="form-check-input ms-1" id="job-attach-base-files" type="checkbox" value="" name="job-attach-base-files" onchange="updateDropZoneTarget();">
						</div>
					</div>

					<!-- Footer -->
					<div class="modal-footer d-flex justify-content-between p-2 bg-dark text-light">
						<label class="text-danger" id="job-error-message"></label>
						<div style="position: relative; max-height: 50px;">
							<button id="create-job-button" type="submit" class="btn btn-outline-primary border-2 rounded-pill" disabled>
								<svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor" class="bi bi-plus" viewBox="4 2.5 13 13">
									<path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
								</svg>
							Create</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<!-- Templated Variables -->
<script>

	const csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value;

	let SUPPORTED_LANGUAGES = {{ SUPPORTED_LANGUAGES | js }};
	let SUPPORTED_ARCHIVES = {{ SUPPORTED_ARCHIVES | js }};
	let FILES_NAME = "{{ FILES_NAME }}";
	let BASE_FILES_NAME = "{{ BASE_FILES_NAME }}";

	let statuses = {{ STATUSES | js }};
	let inQueueStatus = "{{ INQUEUE_STATUS }}";
	let processingStatus = "{{ PROCESSING_STATUS }}";
	let parsingStatus = "{{ PARSING_STATUS }}";
	let completedStatus = "{{ COMPLETED_STATUS }}";
	let failedStatus = "{{ FAILED_STATUS }}";

	let NEW_JOB_URL = "{% url "jobs:new" %}";
	let GET_JOBS_URL = "{% url "api:jobs:get_jobs" %}";
	let GET_JOB_STATUSES_URL = "{% url "api:jobs:get_statuses" %}";

	let POLLING_TIME = {{ POLLING_TIME | js }};
	let DEFAULT_MOSS_SETTINGS = {{ DEFAULT_MOSS_SETTINGS | js }};

</script>

{% endblock %}